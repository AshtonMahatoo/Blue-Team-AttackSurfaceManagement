# SP101 ASM - Logging Configuration
# Version: 1.3.0

# Root logger configuration
root:
  level: "INFO"
  handlers: ["console", "file", "graylog"]
  propagate: true

# Logger hierarchy
loggers:
  # Application loggers
  "sp101_asm":
    level: "INFO"
    handlers: ["console", "file", "graylog"]
    propagate: false
    
  "sp101_asm.core":
    level: "DEBUG"
    handlers: ["file", "graylog"]
    propagate: true
    
  "sp101_asm.core.asset_discovery":
    level: "INFO"
    handlers: ["file", "graylog"]
    propagate: true
    
  "sp101_asm.core.vulnerability_scanner":
    level: "INFO"
    handlers: ["file", "graylog"]
    propagate: true
    
  "sp101_asm.graylog_integration":
    level: "WARNING"
    handlers: ["console", "file"]
    propagate: true
    
  "sp101_asm.api":
    level: "INFO"
    handlers: ["console", "file", "graylog"]
    propagate: true
    
  # Third-party loggers
  "urllib3":
    level: "WARNING"
    handlers: ["file"]
    propagate: false
    
  "requests":
    level: "WARNING"
    handlers: ["file"]
    propagate: false
    
  "sqlalchemy":
    level: "WARNING"
    handlers: ["file"]
    propagate: false
    
  "aiohttp":
    level: "WARNING"
    handlers: ["file"]
    propagate: false

# Handler configurations
handlers:
  # Console handler
  console:
    class: "logging.StreamHandler"
    level: "INFO"
    formatter: "colored"
    stream: "ext://sys.stdout"
    
    # Filters
    filters: ["important_only"]
    
  # File handler (rotating)
  file:
    class: "logging.handlers.RotatingFileHandler"
    level: "DEBUG"
    formatter: "detailed"
    filename: "/var/log/asm/asm.log"
    maxBytes: 10485760  # 10MB
    backupCount: 10
    encoding: "utf-8"
    
    # Rotation
    when: "midnight"
    interval: 1
    backupCount: 30
    
  # Graylog handler (GELF)
  graylog:
    class: "graypy.GELFUDPHandler"
    level: "INFO"
    host: "${GRAYLOG_HOST:-localhost}"
    port: 5555
    
    # GELF specific
    debugging_fields: false
    extra_fields: true
    facility: "sp101-asm"
    
    # Additional fields
    static_fields:
      application: "sp101-asm"
      environment: "${ENVIRONMENT:-production}"
      host: "${HOSTNAME}"
      
    # Filters
    filters: ["no_sensitive_data"]
    
  # JSON file handler (for log analysis)
  json_file:
    class: "logging.handlers.RotatingFileHandler"
    level: "INFO"
    formatter: "json"
    filename: "/var/log/asm/asm_json.log"
    maxBytes: 10485760  # 10MB
    backupCount: 5
    
  # Email handler (for critical errors)
  email:
    class: "logging.handlers.SMTPHandler"
    level: "ERROR"
    formatter: "email"
    
    mailhost: "${SMTP_HOST:-localhost}"
    fromaddr: "asm-alerts@example.com"
    toaddrs:
      - "sre-team@example.com"
      - "security-team@example.com"
      
    subject: "[SP101-ASM CRITICAL] Application Error"
    credentials:
      - "${SMTP_USERNAME}"
      - "${SMTP_PASSWORD}"
      
    secure: []
    
    # Filters
    filters: ["critical_only"]
    
  # Syslog handler
  syslog:
    class: "logging.handlers.SysLogHandler"
    level: "WARNING"
    formatter: "syslog"
    address: "/dev/log"  # For Linux
    # address: ("localhost", 514)  # For remote syslog
    
    facility: "local7"
    socktype: "ext://socket.SOCK_STREAM"
    
  # Windows Event Log handler
  eventlog:
    class: "logging.handlers.NTEventLogHandler"
    level: "ERROR"
    appname: "SP101-ASM"
    logtype: "Application"
    
  # Slack handler
  slack:
    class: "slack_log_handler.SlackLogHandler"
    level: "ERROR"
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#application-errors"
    username: "SP101-ASM Bot"
    icon_emoji: ":robot_face:"
    
    # Filters
    filters: ["critical_slack"]

# Formatter configurations
formatters:
  # Simple console format
  simple:
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
    
  # Colored console format
  colored:
    format: "%(log_color)s%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
    
    # Color scheme
    log_colors:
      DEBUG: "cyan"
      INFO: "green"
      WARNING: "yellow"
      ERROR: "red"
      CRITICAL: "red,bg_white"
      
  # Detailed format (for files)
  detailed:
    format: "%(asctime)s - %(name)s - %(levelname)s - %(module)s:%(funcName)s:%(lineno)d - %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
    
  # JSON format (for log analysis)
  json:
    class: "pythonjsonlogger.jsonlogger.JsonFormatter"
    format: "%(asctime)s %(name)s %(levelname)s %(module)s %(funcName)s %(lineno)d %(message)s"
    
    # JSON fields
    reserved_attrs:
      - "args"
      - "asctime"
      - "created"
      - "exc_info"
      - "exc_text"
      - "filename"
      - "funcName"
      - "levelname"
      - "levelno"
      - "lineno"
      - "module"
      - "msecs"
      - "message"
      - "msg"
      - "name"
      - "pathname"
      - "process"
      - "processName"
      - "relativeCreated"
      - "stack_info"
      - "thread"
      - "threadName"
      
    # Custom fields
    static_fields:
      application: "sp101-asm"
      environment: "${ENVIRONMENT:-production}"
      hostname: "${HOSTNAME}"
      
  # Syslog format
  syslog:
    format: "sp101-asm[%(process)d]: %(levelname)s %(name)s %(message)s"
    
  # Email format
  email:
    format: |
      SP101 ASM Application Error
      ===========================
      
      Time: %(asctime)s
      Logger: %(name)s
      Level: %(levelname)s
      Module: %(module)s
      Function: %(funcName)s
      Line: %(lineno)d
      
      Message:
      %(message)s
      
      Traceback:
      %(exc_text)s
      
    datefmt: "%Y-%m-%d %H:%M:%S %Z"

# Filter configurations
filters:
  # Filter out sensitive data
  no_sensitive_data:
    class: "sp101_asm.utils.logging_filters.SensitiveDataFilter"
    
    patterns:
      - "password"
      - "api_key"
      - "secret"
      - "token"
      - "private_key"
      
    replacement: "***REDACTED***"
    
  # Only allow important messages t